<!DOCTYPE html>
<html>
<head>
    <title>创建GS文件</title>
    <style>
        body {
            font-family: Arial;
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
        }
        input, button {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
        }
        button {
            background: #4285f4;
            color: white;
            border: none;
            cursor: pointer;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            display: none;
        }
        .success { background: #e8f5e8; }
        .error { background: #ffe8e8; }
    </style>
</head>
<body>
    <h2>在Google Drive创建GS文件</h2>
    
    <input type="text" id="fileName" placeholder="输入文件名（例如：你好）" />
    <button onclick="createGS()">创建GS文件</button>
    
    <div id="result"></div>
    
    <!-- 隐藏的iframe用于提交表单 -->
    <iframe name="hiddenIframe" style="display:none;"></iframe>
    
    <!-- 隐藏的表单 -->
    <form id="hiddenForm" target="hiddenIframe" method="post" style="display:none;">
        <input type="hidden" name="fileName" id="formFileName">
    </form>
    
    <script>
        // 替换成你自己的GAS Web应用URL
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzrK72MjUzj2PlI_ezU3AIhcNDljODxlWnY_3iFTXvjhy5JBN3vqchG_RYYzjB2OTke/exec";
        
        function createGS() {
            const fileName = document.getElementById('fileName').value;
            if (!fileName) {
                alert("请输入文件名");
                return;
            }
            
            // 设置表单数据并提交
            document.getElementById('formFileName').value = fileName;
            document.getElementById('hiddenForm').action = GAS_URL;
            document.getElementById('hiddenForm').submit();
            
            // 监听iframe加载完成
            const iframe = document.getElementsByName('hiddenIframe')[0];
            iframe.onload = function() {
                try {
                    // 获取响应
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    const responseText = iframeDoc.body.textContent;
                    const response = JSON.parse(responseText);
                    
                    // 显示结果
                    const resultDiv = document.getElementById('result');
                    if (response.success) {
                        resultDiv.innerHTML = `
                            <h3>✅ 创建成功！</h3>
                            <p><b>文件名：</b>${response.fileName}.gs</p>
                            <p><b>文件ID：</b>${response.fileId}</p>
                            <p><b>下载链接：</b> 
                              <a href="${response.downloadUrl}" target="_blank">点击下载</a>
                            </p>
                            <p><b>Google Drive链接：</b> 
                              <a href="${response.fileUrl}" target="_blank">点击查看</a>
                            </p>
                        `;
                        resultDiv.className = "success";
                    } else {
                        resultDiv.innerHTML = `
                            <h3>❌ 创建失败</h3>
                            <p>${response.message}</p>
                        `;
                        resultDiv.className = "error";
                    }
                    resultDiv.style.display = "block";
                    
                } catch (e) {
                    document.getElementById('result').innerHTML = 
                        `<h3>❌ 解析响应失败</h3><p>${e.message}</p>`;
                    document.getElementById('result').className = "error";
                    document.getElementById('result').style.display = "block";
                }
            };
        }
        
        // 页面加载时显示说明
        window.onload = function() {
            document.getElementById('result').innerHTML = `
                <h3>使用说明：</h3>
                <p>1. 在上方输入文件名（不需要加 .gs）</p>
                <p>2. 点击"创建GS文件"按钮</p>
                <p>3. 等待结果...</p>
                <p><small>注意：需要在代码中设置正确的GAS_URL</small></p>
            `;
            document.getElementById('result').className = "";
            document.getElementById('result').style.display = "block";
        };
    </script>
</body>
</html>
